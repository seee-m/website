name: Generate Media Lists

on:
  push:
    paths:
      - 'media/background/**'
      - 'media/work/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-lists:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Generate media list files
        run: |
          python << 'EOF'
          import os
          
          def generate_image_list(directory, output_file):
              """Generate a text file listing all images and videos in a directory"""
              if not os.path.exists(directory):
                  print(f"Directory not found: {directory}")
                  return

              # Get all media files (images and videos), excluding the thumbs subdirectory
              media_extensions = ('.jpg', '.jpeg', '.png', '.gif', '.webp', '.mp4', '.webm')
              media_files = []

              for filename in os.listdir(directory):
                  filepath = os.path.join(directory, filename)
                  # Skip if it's a directory or not a supported media file
                  if os.path.isdir(filepath) or not filename.lower().endswith(media_extensions):
                      continue
                  media_files.append(filename)

              # Sort alphabetically for consistency
              media_files.sort()

              # Write to file
              output_path = os.path.join(directory, output_file)
              with open(output_path, 'w') as f:
                  f.write('\n'.join(media_files))

              print(f"âœ“ Generated {output_path} with {len(media_files)} media files")
          
          # Generate both list files
          print("Generating media lists...")
          generate_image_list('media/background', 'background.txt')
          generate_image_list('media/work', 'work.txt')

          print("\nâœ“ All media lists generated!")
          EOF
          
      - name: Commit and push media lists
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add media/background/background.txt media/work/work.txt
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ“ Auto-generate media list files" && git push)
