<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info</title>
    <link rel="stylesheet" href="../../shared.css">
    <link rel="stylesheet" href="info.css">
    <link rel="stylesheet" href="../../directory-component.css">
</head>
<body>
    <img id="bgImage" class="background-image" alt="Background">
    <h1 id="overlayText" class="text-overlay"></h1>

    <header class="header">
        <div class="box title-box">
            <div class="title-box-top">
                <div class="links-container">
                    <a href="https://www.are.na/connor-macdonald-aygwd2z45ek" class="nav-link">[★★]</a>
                    <a href="https://www.instagram.com/sensoryworks_" class="nav-link">[insta]</a>
                    <a href="https://github.com/seee-m" class="nav-link">[github]</a>
                    <a href="mailto:hello@sensory.works" class="nav-link">[email]</a>
                </div>

                <svg class="svg-logo" viewBox="0 0 115.03 122.9">
                <g id="Layer_1-2" data-name="Layer 1">
                <path d="M96.31,110.11c-4.38,5.14-10.69,8.26-17.34,7.44-2.67-.28-5.35-.75-8.04-.45-2.33.27-4.7.92-6.9,1.66-4.06,1.51-7.66.58-12.86,1.67-4.19.75-8.44,2.5-12.69,2.46-18.6-2.18-26.96-24.62-31.44-39.92-4.38-13.26-10.9-29.36-4.09-42.66,10.53-14.96,24.78-17.03,40.6-9.57,4.38,2.3,11.96,3.52,9.95-4.02-1.35-5.28-7.06-9.26-10.11-13.1-1.8-2.14-2.08-5.06-.3-6.79,5.4-4.47,9.29,4.5,13.87,5.96,2.8.77,5.07-3,8.34-5.78,5.07-3.96,12.73-7.85,18.8-6.85,10.48,3.23-1.91,14.77-7.33,16.98-4.76,2.91-13.12,2.24-14.68,6.4-1.12,3.57-1.73,9.71.69,12.64,2.12,1.18,4.79-.66,7.04-1.64,51.99-28.82,56.52,40.2,26.95,75.05l-.47.53ZM69.4,13.06c3.16-.24,9.16-2.08,9.28-5.94-3.28.39-7.32,3.11-9.34,5.78l.06.16Z"/>
                </g>
                </svg>

            </div>

            <div class="title-box-bottom">
                <button id="directoryToggle" class="nav-link">[directory]</button>
                <div style="display: flex; gap: 10px; margin-left: auto;">
                    <button id="bgToggle" class="nav-link mono-text-button">⏻</button>
                    <button id="rerollButton" class="nav-link">[randomise]</button>
                </div>
            </div>

        </div>

        <div class="box controls-box">
            <p class="readout" id="fileReadout"></p>
        </div>
    </header>

    <script>
        const TYPING_SPEED = 50; // milliseconds per character
        const random = arr => arr[Math.floor(Math.random() * arr.length)];
        
        // Random selection excluding last pick
        function randomExcluding(array, exclude) {
            if (array.length <= 1) return array[0];
            let item;
            do {
                item = array[Math.floor(Math.random() * array.length)];
            } while (item === exclude);
            return item;
        }
        
        let currentSlogan = '';
        let currentImageFile = '';
        let slogans = [];
        let images = [];
        let typewriterTimeout;
        let lastImage = null;
        let lastSlogan = null;

        async function loadImages() {
            try {
                const response = await fetch('/media/background/background.txt');
                const text = await response.text();
                images = text.split('\n').filter(line => line.trim()).map(img => `/media/background/${img}`);
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        async function loadSlogans() {
            try {
                const response = await fetch('slogans.txt');
                const text = await response.text();
                slogans = text.split('\n').filter(line => line.trim());
            } catch (error) {
                console.error('Error loading slogans:', error);
            }
        }

        // Typewriter effect
        function typeWriter(text, element) {
            // Clear any existing timeout
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            element.textContent = '';
            let index = 0;
            
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    typewriterTimeout = setTimeout(type, TYPING_SPEED);
                }
            }
            
            type();
        }

        function randomize() {
            if (images.length > 0) {
                const imagePath = randomExcluding(images, lastImage);
                lastImage = imagePath;
                document.getElementById('bgImage').src = imagePath;
                currentImageFile = imagePath.replace('/media/background/', '');
                
                // Use typewriter effect for filename
                const readoutElement = document.getElementById('fileReadout');
                typeWriter(currentImageFile, readoutElement);
            }
            
            if (slogans.length > 0) {
                const slogan = randomExcluding(slogans, lastSlogan);
                lastSlogan = slogan;
                displayText(slogan);
            }
        }

        function displayText(slogan) {
            currentSlogan = slogan;
            const textElement = document.getElementById('overlayText');
            textElement.textContent = slogan;
        }

        async function init() {
            await Promise.all([loadImages(), loadSlogans()]);
            randomize();
        }

        document.getElementById('rerollButton').addEventListener('click', randomize);

        // Background toggle
        let backgroundVisible = true;
        document.getElementById('bgToggle').addEventListener('click', function() {
            const bgElement = document.getElementById('bgImage');
            backgroundVisible = !backgroundVisible;
            bgElement.style.display = backgroundVisible ? 'block' : 'none';
        });

        init();
    </script>
    <script src="../../directory-component.js"></script>
</body>
</html>