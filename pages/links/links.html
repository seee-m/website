<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Links</title>
    <link rel="stylesheet" href="../../shared.css">
    <link rel="stylesheet" href="links.css">
</head>

<body>
    
    <img id="bgImage" class="background-image" alt="Background">
    <h1 id="overlayText" class="text-overlay"></h1>
    
    <header class="header">
        <div class="title-box">
            <button onclick="window.location.href='../../index.html'" class="home-link">[c-m] Connor MacDonald is an applied artist + designer currently working at International Magic Studio.</button>
        </div>

        <div class="readout-box">
            <p class="readout" id="fileReadout"></p>
        </div>
        
        <nav class="nav-box">
            <button onclick="window.location.href='../music/music.html'" class="nav-link">[music]</button>
            <button onclick="window.location.href='../wisdom/wisdom.html'" class="nav-link">[advice]</button>
            <button id="rerollButton" class="nav-link">[randomise]</button>
        </nav>
        
    </header>

    <script>
        const TYPING_SPEED = 50; // milliseconds per character
        const random = arr => arr[Math.floor(Math.random() * arr.length)];
        
        // Random selection excluding last pick
        function randomExcluding(array, exclude) {
            if (array.length <= 1) return array[0];
            let item;
            do {
                item = array[Math.floor(Math.random() * array.length)];
            } while (item === exclude);
            return item;
        }
        
        let currentSlogan = '';
        let currentImageFile = '';
        let colorPairs = [];
        let slogans = [];
        let images = [];
        let typewriterTimeout;
        let lastImage = null;
        let lastSlogan = null;
        let lastColorPair = null;

        async function loadColors() {
            try {
                const response = await fetch('colors.txt');
                const text = await response.text();
                colorPairs = text.split('\n')
                    .filter(line => line.trim())
                    .map(line => {
                        const [fill, stroke] = line.split(',').map(c => c.trim());
                        return { fill, stroke };
                    });
            } catch (error) {
                console.error('Error loading colors:', error);
            }
        }

        async function loadImages() {
            try {
                const response = await fetch('/media/background/background.txt');
                const text = await response.text();
                images = text.split('\n').filter(line => line.trim()).map(img => `/media/background/${img}`);
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        async function loadSlogans() {
            try {
                const response = await fetch('slogans.txt');
                const text = await response.text();
                slogans = text.split('\n').filter(line => line.trim());
            } catch (error) {
                console.error('Error loading slogans:', error);
            }
        }

        // Typewriter effect
        function typeWriter(text, element) {
            // Clear any existing timeout
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            element.textContent = '';
            let index = 0;
            
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    typewriterTimeout = setTimeout(type, TYPING_SPEED);
                }
            }
            
            type();
        }

        function applyColors(colors) {
    const textElement = document.getElementById('overlayText');
    const titleBox = document.querySelector('.title-box');
    
    textElement.style.color = colors.fill;
    textElement.style.webkitTextStroke = `0.018em ${colors.stroke}`;
    titleBox.style.backgroundColor = colors.fill;
    
    // Remove old hover style if it exists
    const oldStyle = document.getElementById('dynamic-hover-style');
    if (oldStyle) {
        oldStyle.remove();
    }
    
    // Create new style tag with hover color
    const styleTag = document.createElement('style');
    styleTag.id = 'dynamic-hover-style';
    styleTag.textContent = `.nav-link:hover { color: ${colors.fill} !important; }`;
    document.head.appendChild(styleTag);
}

        function randomize() {
            if (colorPairs.length > 0) {
                const colors = randomExcluding(colorPairs, lastColorPair);
                lastColorPair = colors;
                applyColors(colors);
            }
            
            if (images.length > 0) {
                const imagePath = randomExcluding(images, lastImage);
                lastImage = imagePath;
                document.getElementById('bgImage').src = imagePath;
                currentImageFile = imagePath.replace('/media/background/', '');
                
                // Use typewriter effect for filename
                const readoutElement = document.getElementById('fileReadout');
                typeWriter(currentImageFile, readoutElement);
            }
            
            if (slogans.length > 0) {
                const slogan = randomExcluding(slogans, lastSlogan);
                lastSlogan = slogan;
                displayText(slogan);
            }
        }

        function displayText(slogan) {
            currentSlogan = slogan;
            const textElement = document.getElementById('overlayText');
            
            // On mobile, split into one word per line for better sizing
            if (window.innerWidth <= 600) {
                textElement.innerHTML = slogan.split(' ').join('<br>');
                
                // Position vertically centered between nav-box bottom and screen bottom
                setTimeout(() => {
                    const navBox = document.querySelector('.nav-box');
                    if (navBox) {
                        const navBoxRect = navBox.getBoundingClientRect();
                        const navBoxBottom = navBoxRect.bottom;
                        const screenBottom = window.innerHeight;
                        const centerPoint = navBoxBottom + (screenBottom - navBoxBottom) / 2;
                        
                        textElement.style.top = centerPoint + 'px';
                    }
                    
                    const maxHeight = window.innerHeight * 0.6; // 60vh max
                    const maxWidth = window.innerWidth - 48; // Account for 1.5rem padding on each side
                    
                    // Reset to let clamp work
                    textElement.style.fontSize = '';
                    
                    // If it overflows height or width, scale it down
                    let currentSize = parseFloat(getComputedStyle(textElement).fontSize);
                    const minSize = 32; // 2rem minimum
                    
                    while ((textElement.scrollHeight > maxHeight || textElement.scrollWidth > maxWidth) && currentSize > minSize) {
                        currentSize -= 2;
                        textElement.style.fontSize = currentSize + 'px';
                    }
                }, 50);
            } else {
                textElement.style.fontSize = '';
                textElement.style.top = '';
                textElement.textContent = slogan;
            }
        }

        async function init() {
            await Promise.all([loadColors(), loadImages(), loadSlogans()]);
            randomize();
        }

        document.getElementById('rerollButton').addEventListener('click', randomize);

        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                if (currentSlogan) displayText(currentSlogan);
            }, 150);
        });

        init();
    </script>
</body>
</html>