<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <link rel="stylesheet" href="music.css">
</head>
<body>
    <div class="header">
        <div class="box title-box">
            <button onclick="window.location.href='../../index.html'" class="home-link">[c-m] audio work</button>
            <br><br>
            <button id="playPauseBtn">[PLAY]</button>
            <button id="hideShowBtn">[HIDE BROWSER]</button>
        </div>

        <div class="box controls-box" id="controlsBox">
            <p id="nowPlaying">NO FILE LOADED</p>
            <p id="timeDisplay">0:00 / 0:00</p>
        </div>
        
        <div class="box playlist-box" id="playlistBox">
            <div class="scroll-arrow scroll-arrow-up" id="scrollUpArrow">▲</div>
            <div class="playlist-scroll" id="playlistScroll">
                <ul class="track-list" id="trackList"></ul>
            </div>
            <div class="scroll-arrow scroll-arrow-down" id="scrollDownArrow">▼</div>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        const manifest = {
            "folders": [
                {
                    "name": "Exports",
                    "files": [
                        "Ambient_001.mp3",
                        "Ambient_002.mp3",
                        "Downtempo_001.mp3",
                        "Downtempo_002.mp3",
                        "Drone_Ambient_Looping.mp3",
                        "Drone_Percussion.mp3",
                        "Joyful_001.mp3",
                        "Joyful_002.mp3",
                        "Uptempo_001.mp3",
                        "Uptempo_002.mp3"
                    ]
                }
            ],
            "files": ["wl_amb.mp3"]
        };

        let currentPath = 'root';
        let currentFiles = [];
        let currentTrackIndex = -1;
        let isPlaying = false;

        const audioPlayer = document.getElementById('audioPlayer');
        const trackList = document.getElementById('trackList');
        const pathDisplay = document.getElementById('pathDisplay')
        const nowPlaying = document.getElementById('nowPlaying');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const hideShowBtn = document.getElementById('hideShowBtn');
        const timeDisplay = document.getElementById('timeDisplay');
        const controlsBox = document.getElementById('controlsBox');
        const playlistBox = document.getElementById('playlistBox');
        const playlistScroll = document.getElementById('playlistScroll');
        const scrollUpArrow = document.getElementById('scrollUpArrow');
        const scrollDownArrow = document.getElementById('scrollDownArrow');

        function updateScrollArrows() {
            const scrollTop = playlistScroll.scrollTop;
            const scrollHeight = playlistScroll.scrollHeight;
            const clientHeight = playlistScroll.clientHeight;
            
            scrollUpArrow.classList.toggle('visible', scrollTop > 0);
            scrollDownArrow.classList.toggle('visible', scrollTop + clientHeight < scrollHeight - 1);
        }

        function loadFiles() {
            const items = [];
            
            if (currentPath === 'root') {
                manifest.folders.forEach(folder => {
                    items.push({ name: folder.name, type: 'folder' });
                });
                manifest.files.forEach(file => {
                    items.push({ name: file, type: 'audio' });
                });
            } else {
                const folder = manifest.folders.find(f => f.name === currentPath);
                if (folder) {
                    folder.files.forEach(file => {
                        items.push({ name: file, type: 'audio' });
                    });
                }
            }
            
            currentFiles = items;
            renderTracks();
        }

        function renderTracks() {
            trackList.innerHTML = '';
            pathDisplay.textContent = currentPath === 'root' ? '/MUSIC' : `/MUSIC/${currentPath}`.toUpperCase();
            
            if (currentPath !== 'root') {
                const li = document.createElement('li');
                li.className = 'track-item parent-folder';
                li.innerHTML = '<span class="track-name">&nbsp;[PARENT]</span><span class="track-type">&lt;DIR&gt;</span>';
                li.onclick = navigateUp;
                trackList.appendChild(li);
            }

            currentFiles.forEach((item, index) => {
                const li = document.createElement('li');
                
                if (item.type === 'folder') {
                    li.className = 'track-item';
                    li.innerHTML = `<span class="track-name">${item.name}</span><span class="track-type">&lt;DIR&gt;</span>`;
                    li.onclick = () => navigateInto(item.name);
                } else {
                    li.className = 'track-item audio';
                    li.innerHTML = `<span class="track-name">${item.name}</span>`;
                    const audioFiles = currentFiles.filter(f => f.type === 'audio');
                    const audioIndex = audioFiles.findIndex(f => f.name === item.name);
                    li.onclick = () => playFile(audioIndex);
                }
                
                trackList.appendChild(li);
            });
            
            setTimeout(updateScrollArrows, 100);
        }

        function navigateInto(folderName) {
            currentPath = folderName;
            loadFiles();
        }

        function navigateUp() {
            currentPath = 'root';
            loadFiles();
        }

        function playFile(index) {
            const audioFiles = currentFiles.filter(f => f.type === 'audio');
            currentTrackIndex = index;
            const file = audioFiles[index];
            
            if (file) {
                // Construct path based on current location
                const basePath = currentPath === 'root' ? '../../media/music' : `../../media/music/${currentPath}`;
                audioPlayer.src = `${basePath}/${file.name}`;
                audioPlayer.play();
                isPlaying = true;
                
                nowPlaying.textContent = file.name.toUpperCase();
                playPauseBtn.textContent = '[PAUSE]';
                updatePlayingState();
            }
        }

        function updatePlayingState() {
            const items = document.querySelectorAll('.track-item.audio');
            const audioFiles = currentFiles.filter(f => f.type === 'audio');
            const currentFile = audioFiles[currentTrackIndex];
            
            items.forEach(item => {
                const itemName = item.querySelector('.track-name').textContent;
                item.classList.remove('selected', 'playing');
                if (currentFile && itemName === currentFile.name) {
                    if (!audioPlayer.paused) {
                        item.classList.add('playing');
                    } else {
                        item.classList.add('selected');
                    }
                }
            });
        }

        playPauseBtn.onclick = () => {
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                playPauseBtn.textContent = '[PLAY]';
            } else {
                if (currentTrackIndex >= 0) {
                    audioPlayer.play();
                    isPlaying = true;
                    playPauseBtn.textContent = '[PAUSE]';
                } else {
                    const audioFiles = currentFiles.filter(f => f.type === 'audio');
                    if (audioFiles.length > 0) playFile(0);
                }
            }
            updatePlayingState();
        };

        hideShowBtn.onclick = () => {
            const isHidden = controlsBox.style.display === 'none';
            controlsBox.style.display = isHidden ? 'flex' : 'none';
            playlistBox.style.display = isHidden ? 'block' : 'none';
            hideShowBtn.textContent = isHidden ? '[HIDE BROWSER]' : '[SHOW BROWSER]';
        };

        audioPlayer.addEventListener('timeupdate', () => {
            const current = formatTime(audioPlayer.currentTime);
            const total = formatTime(audioPlayer.duration);
            timeDisplay.textContent = `${current} / ${total}`;
        });

        audioPlayer.addEventListener('ended', () => {
            const audioFiles = currentFiles.filter(f => f.type === 'audio');
            if (currentTrackIndex < audioFiles.length - 1) {
                playFile(currentTrackIndex + 1);
            } else {
                isPlaying = false;
                playPauseBtn.textContent = '[PLAY]';
                updatePlayingState();
            }
        });

        audioPlayer.addEventListener('play', () => {
            isPlaying = true;
            updatePlayingState();
        });

        audioPlayer.addEventListener('pause', () => {
            isPlaying = false;
            updatePlayingState();
        });

        playlistScroll.addEventListener('scroll', updateScrollArrows);

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                playPauseBtn.click();
            }
        });

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        loadFiles();
    </script>
</body>
</html>